<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold-Plus ROI Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@0.344.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .step-panel { display: none; }
        .step-panel.active { display: block; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            margin-top: -7px;
        }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto">

        <!-- HEADER -->
        <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <div class="flex items-center gap-2 text-blue-600 font-bold text-2xl mb-1">
                    <i data-lucide="wind" class="w-8 h-8"></i>
                    COLD-PLUS SAVINGS TOOL
                </div>
                <p class="text-slate-500 font-medium italic text-sm">Inventive Energy Solutions - Smart Savings Projection</p>
            </div>
            <div class="flex gap-1" id="progress-dots">
                <div class="h-2 w-12 rounded-full bg-blue-600"></div>
                <div class="h-2 w-12 rounded-full bg-slate-200"></div>
                <div class="h-2 w-12 rounded-full bg-slate-200"></div>
                <div class="h-2 w-12 rounded-full bg-slate-200"></div>
                <div class="h-2 w-12 rounded-full bg-slate-200"></div>
            </div>
        </div>

        <!-- FORM CONTAINER -->
        <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-6 md:p-10 mb-8 min-h-[500px]">

            <!-- STEP 1 -->
            <div id="step-1" class="step-panel active">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="building-2" class="text-blue-600"></i>
                    <h2 class="text-xl font-bold">Facility Information</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-600">Test Location Name</label>
                        <input type="text" id="locName" placeholder="e.g. Northeast Regional Hospital" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-600">Yearly Chiller kWh</label>
                        <input type="number" id="kwh" value="1250000" class="w-full p-3 border rounded-xl outline-none">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-600">Cost per kWh ($)</label>
                        <input type="number" id="rate" value="0.12" step="0.01" class="w-full p-3 border rounded-xl outline-none">
                    </div>
                </div>
                <div class="mt-8 bg-blue-50 p-4 rounded-xl border border-blue-100 flex gap-3 text-sm text-blue-800">
                    <i data-lucide="info" class="shrink-0"></i>
                    <p>Enter your facility's baseline data to begin the ROI projection.</p>
                </div>
            </div>

            <!-- STEP 2 -->
            <div id="step-2" class="step-panel">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="zap" class="text-amber-500"></i>
                    <h2 class="text-xl font-bold">Pilot Test Compressor</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" placeholder="Manufacturer" class="p-3 border rounded-xl">
                    <input type="text" placeholder="Model #" class="p-3 border rounded-xl">
                    <input type="number" placeholder="Tons" value="200" class="p-3 border rounded-xl">
                    <select class="p-3 border rounded-xl">
                        <option>R-134a</option>
                        <option>R-410A</option>
                    </select>
                    <select class="p-3 border rounded-xl">
                        <option>Air Cooled</option>
                        <option>Water Cooled</option>
                    </select>
                    <input type="number" placeholder="Annual kWh" value="450000" class="p-3 border rounded-xl">
                </div>
            </div>

            <!-- STEP 3 -->
            <div id="step-3" class="step-panel">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="settings" class="text-slate-600"></i>
                    <h2 class="text-xl font-bold">Monitoring Systems</h2>
                </div>
                <div class="p-6 bg-slate-50 rounded-2xl border">
                    <label class="flex items-center justify-between cursor-pointer">
                        <span class="font-bold">Existing Plant Management System?</span>
                        <input type="checkbox" class="w-6 h-6 rounded border-slate-300">
                    </label>
                </div>
            </div>

            <!-- STEP 4 -->
            <div id="step-4" class="step-panel">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="calculator" class="text-emerald-600"></i>
                    <h2 class="text-xl font-bold">Financial Assumptions</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-sm font-medium">Implementation Cost ($)</label>
                            <input type="number" id="cost" value="25000" class="w-full p-3 border rounded-xl">
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-medium">Expected Efficiency Gain: <span id="pctVal" class="text-emerald-600 font-bold">15%</span></label>
                            <input type="range" id="pct" min="5" max="25" value="15" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 5 -->
            <div id="step-5" class="step-panel">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-2xl font-bold">Financial Results</h2>
                    <span class="bg-emerald-100 text-emerald-700 px-4 py-1 rounded-full text-xs font-bold uppercase">Projected</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-slate-50 p-5 rounded-2xl text-center">
                        <p class="text-slate-500 text-xs uppercase font-bold mb-1">Annual Savings</p>
                        <h3 id="res-savings" class="text-2xl font-black text-emerald-600">$0</h3>
                    </div>
                    <div class="bg-slate-50 p-5 rounded-2xl text-center">
                        <p class="text-slate-500 text-xs uppercase font-bold mb-1">Payback Period</p>
                        <h3 id="res-payback" class="text-2xl font-black text-blue-600">0 Months</h3>
                    </div>
                    <div class="bg-slate-50 p-5 rounded-2xl text-center">
                        <p class="text-slate-500 text-xs uppercase font-bold mb-1">IRR (5-Year)</p>
                        <h3 id="res-irr" class="text-2xl font-black text-indigo-600">0%</h3>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 h-64 mb-8">
                    <div class="border rounded-xl p-2"><canvas id="pChart"></canvas></div>
                    <div class="border rounded-xl p-2"><canvas id="bChart"></canvas></div>
                </div>
                <button onclick="window.print()" class="no-print w-full py-4 bg-slate-800 text-white rounded-xl font-bold flex items-center justify-center gap-2">
                    ✓ Print Proposal
                </button>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="flex justify-between items-center px-4 no-print">
            <button id="prev" onclick="changeStep(-1)" class="flex items-center gap-2 px-6 py-3 font-bold text-slate-400" style="visibility: hidden;">
                ← Back
            </button>
            <button id="next" onclick="changeStep(1)" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 shadow-lg">
                Continue →
            </button>
        </div>
    </div>

    <script>
        let current = 1;
        let pChart, bChart;

        // Safely initialize Lucide icons — don't let it break functionality
        function safeCreateIcons() {
            try {
                if (typeof lucide !== 'undefined' && lucide.createIcons) {
                    lucide.createIcons();
                }
            } catch (e) {
                // Icons are cosmetic — app works without them
            }
        }

        // Initialize icons when page is ready
        document.addEventListener('DOMContentLoaded', function() {
            safeCreateIcons();
        });

        // Also try after a short delay in case the CDN is slow
        window.addEventListener('load', function() {
            safeCreateIcons();
        });

        function changeStep(dir) {
            if (current + dir < 1 || current + dir > 5) {
                if (current === 5 && dir === 1) {
                    current = 1;
                } else {
                    return;
                }
            } else {
                current += dir;
            }
            updateUI();
        }

        function updateUI() {
            // Show/hide step panels
            document.querySelectorAll('.step-panel').forEach(function(p, i) {
                p.classList.toggle('active', i + 1 === current);
            });

            // Update progress dots
            var dots = document.getElementById('progress-dots').children;
            for (var i = 0; i < 5; i++) {
                dots[i].className = 'h-2 w-12 rounded-full ' + (i < current ? 'bg-blue-600' : 'bg-slate-200');
            }

            // Update navigation buttons
            document.getElementById('prev').style.visibility = current === 1 ? 'hidden' : 'visible';
            document.getElementById('next').innerText = current === 5 ? '↺ Start Over' : 'Continue →';

            // Re-render any Lucide icons safely
            safeCreateIcons();

            // Calculate results when reaching Step 5
            if (current === 5) {
                calculate();
            }
        }

        // Efficiency gain slider label
        document.getElementById('pct').addEventListener('input', function(e) {
            document.getElementById('pctVal').innerText = e.target.value + '%';
        });

        function calculate() {
            var kwh = parseFloat(document.getElementById('kwh').value);
            var rate = parseFloat(document.getElementById('rate').value);
            var cost = parseFloat(document.getElementById('cost').value);
            var pct = parseFloat(document.getElementById('pct').value) / 100;

            var savings = kwh * pct * rate;
            var payback = (cost / (savings / 12)).toFixed(1);

            // Basic IRR Estimation (Newton-Raphson)
            var r = 0.1;
            for (var i = 0; i < 10; i++) {
                var npv = -cost;
                for (var t = 1; t <= 5; t++) {
                    npv += savings / Math.pow(1 + r, t);
                }
                r += npv / (cost * 2);
            }

            document.getElementById('res-savings').innerText = '$' + Math.round(savings).toLocaleString();
            document.getElementById('res-payback').innerText = payback + ' Months';
            document.getElementById('res-irr').innerText = (r * 100).toFixed(1) + '%';

            drawCharts(kwh * rate, savings, cost);
        }

        function drawCharts(currentTotal, savings, initial) {
            try {
                if (pChart) pChart.destroy();
                if (bChart) bChart.destroy();

                pChart = new Chart(document.getElementById('pChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Base Cost', 'Savings'],
                        datasets: [{
                            data: [currentTotal - savings, savings],
                            backgroundColor: ['#3b82f6', '#10b981']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });

                var projection = [-initial];
                for (var i = 1; i <= 5; i++) {
                    projection.push(Math.round(savings * i - initial));
                }

                bChart = new Chart(document.getElementById('bChart'), {
                    type: 'bar',
                    data: {
                        labels: ['Year 0', 'Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'],
                        datasets: [{
                            label: 'Net Profit',
                            data: projection,
                            backgroundColor: projection.map(function(v) { return v >= 0 ? '#10b981' : '#f43f5e'; })
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (e) {
                // Chart rendering failed — results still show
            }
        }
    </script>
</body>
</html>
